<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Administrar Sistema</title>
     <link rel="stylesheet" href="{{ url_for('static', path='/css/MiPortal.css') }}" />
     <script>
    const USER_ROLE = "{{ role }}";
    console.log("USER_ROLE:", USER_ROLE);
</script>
</head>
<body>
<header class="main-header" id="movible-header">
    <div class="nav-left">
        <a href="{{ url_for('root') }}">
            <img src="{{ url_for('static', path='img/logo_casa.png') }}" alt="Logo_Casa" class="Logo_Casa" />
        </a>
    </div>
    <div class="nav-center">
        <img src="{{ url_for('static', path='img/img.png') }}" alt="Logo Fundación" class="logo" />
    </div>
    <div class="nav-right">
        <img src="{{ url_for('static', path='img/img_1.png') }}" alt="Foto perfil" />
        <div class="dropdown">
            <span>{{ usuario or "Nombre Usuario" }}</span>
            <div class="dropdown-content">
                <a href="{{ url_for('logout') }}">Cerrar sesión</a>
            </div>
        </div>
    </div>
    
</header>
<main>
    <div id="columna-izquierda">
        <div class="menu-item" data-menu="trabajadores">Administrar Trabajadores</div>
        <div class="menu-item" data-menu="clientes">Administrar Clientes</div>
        <div class="menu-item" data-menu="hogares">Administrar Hogares</div>
    </div>
    <div id="columna-secundaria"></div>
    <div id="columna-terciaria">
        <div id="botones-terciarios"></div>
        <div id="formulario-contenedor"></div>
    </div>
</main>
<script>
    const columnaIzquierda = document.getElementById('columna-izquierda');
    const columnaSecundaria = document.getElementById('columna-secundaria');
    const columnaTerciaria = document.getElementById('columna-terciaria');
    const botonesTerciarios = document.getElementById('botones-terciarios');
    const contenedorFormulario = document.getElementById('formulario-contenedor');

    function limpiarSecundaria() {
        columnaSecundaria.innerHTML = '';
        columnaSecundaria.style.display = 'none';
        limpiarTerciaria();
    }

    function limpiarTerciaria() {
        botonesTerciarios.innerHTML = '';
        contenedorFormulario.innerHTML = '';
        columnaTerciaria.style.display = 'none';
    }

    function generarMenuIzquierdoPorRol() {
        columnaIzquierda.innerHTML = '';

        if (USER_ROLE === 'gestor') {
            columnaIzquierda.innerHTML = `
                <div class="menu-item" data-menu="trabajadores">Administrar Trabajadores</div>
                <div class="menu-item" data-menu="clientes">Administrar Clientes</div>
                <div class="menu-item" data-menu="hogares">Administrar Hogares</div>
            `;
        } else if (USER_ROLE === 'cuidador') {
            columnaIzquierda.innerHTML = `
                <div class="menu-item" data-menu="ver-horario">Ver Horario</div>
            `;
        }

        const menuItems = document.querySelectorAll('#columna-izquierda .menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                menuItems.forEach(i => i.classList.remove('activo'));
                item.classList.add('activo');
                limpiarSecundaria();
                limpiarTerciaria();
                const menu = item.getAttribute('data-menu');
                if (menu === 'ver-horario') {
                    mostrarFormularioHorario();
                } else {
                    cargarSecundaria(menu);
                }
            });
        });
    }

    function cargarSecundaria(opcion) {
        columnaSecundaria.style.display = 'block';
        columnaTerciaria.style.display = 'none';

        let html = '';
        if (opcion === 'trabajadores') {
            html = `
                <div class="menu-item" data-submenu="gestores">Gestores</div>
                <div class="menu-item" data-submenu="cuidadores">Cuidadores</div>`;
        } else if (opcion === 'clientes') {
            html = `<div class="menu-item" data-submenu="clientes">Clientes</div>`;
        } else if (opcion === 'hogares') {
            html = `<div class="menu-item" data-submenu="hogares">Hogares</div>`;
        }
        columnaSecundaria.innerHTML = html;

        const submenuItems = columnaSecundaria.querySelectorAll('.menu-item');
        submenuItems.forEach(item => {
            item.addEventListener('click', () => {
                submenuItems.forEach(i => i.classList.remove('activo'));
                item.classList.add('activo');
                const submenu = item.getAttribute('data-submenu');
                cargarTerciaria(submenu);
            });
        });
    }

    function cargarTerciaria(submenu) {
        columnaTerciaria.style.display = 'block';
        botonesTerciarios.innerHTML = '';
        contenedorFormulario.innerHTML = '';

        let botones = [];
        if (submenu === 'gestores') {
            botones = ['Añadir Gestor', 'Eliminar Gestor', 'Modificar Gestor'];
        } else if (submenu === 'cuidadores') {
            botones = ['Añadir Cuidador', 'Eliminar Cuidador', 'Modificar Cuidador', 'Horario Cuidador'];
        } else if (submenu === 'clientes') {
            botones = ['Añadir Cliente', 'Eliminar Cliente', 'Modificar Cliente'];
        } else if (submenu === 'hogares') {
            botones = ['Añadir Hogar', 'Eliminar Hogar', 'Modificar Hogar'];
        }

        if (USER_ROLE === 'cuidador') {
            botones = botones.filter(b => b === 'Horario Cuidador');
        }

        botones.forEach(botonTexto => {
            const btn = document.createElement('button');
            btn.textContent = botonTexto;
            btn.className = 'boton-accion';
            btn.dataset.accion = botonTexto.toLowerCase().replace(/\s/g, '-');
            btn.addEventListener('click', () => manejarAccion(botonTexto, submenu));
            botonesTerciarios.appendChild(btn);
        });
    }

    function manejarAccion(textoBoton, submenu) {
        contenedorFormulario.innerHTML = '';

        if (textoBoton === 'Horario Cuidador') {
            mostrarFormularioHorario();
        } else if (textoBoton.startsWith('Añadir') || textoBoton.startsWith('Modificar')) {
            mostrarFormulario(textoBoton, submenu);
        }
    }

    function mostrarFormularioHorario() {
        const formHTML = `
            <form>
                <h4>Horario Cuidador</h4>
                <label>Día: <input type="text" name="dia" placeholder="Ej: Lunes" required></label>
                <label>Hora inicio: <input type="time" name="horaInicio" required></label>
                <label>Hora fin: <input type="time" name="horaFin" required></label>
                <button type="submit">Guardar Horario</button>
            </form>`;

        const formDiv = document.createElement('div');
        formDiv.innerHTML = formHTML;

        const form = formDiv.querySelector('form');
        form.addEventListener('submit', e => {
            e.preventDefault();
            alert('Horario guardado (simulado)');
            contenedorFormulario.innerHTML = '';
        });

        contenedorFormulario.appendChild(formDiv);
    }

    // Llamada inicial para construir el menú
    generarMenuIzquierdoPorRol();
</script>
</body>
</html>
