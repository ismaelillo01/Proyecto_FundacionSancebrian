<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Administrar Sistema</title>
    <link rel="stylesheet" href="../static/css/MiPortal.css" />
    <link rel="stylesheet" href="../static/css/formulario_admin.css" />
</head>
<body>
<header class="main-header" id="movible-header">
    <div class="nav-left">
        <a href="{{ url_for('root') }}">
            <img src="{{ url_for('static', path='img/logo_casa.png') }}" alt="Logo_Casa" class="Logo_Casa" />
        </a>
    </div>
    <div class="nav-center">
        <img src="{{ url_for('static', path='img/img.png') }}" alt="Logo Fundación" class="logo" />
    </div>
    <div class="nav-right">
        <img src="{{ url_for('static', path='img/img_1.png') }}" alt="Foto perfil" />
        <div class="dropdown">
            <span>{{ usuario or "Nombre Usuario" }}</span>
            <div class="dropdown-content">
                <a href="{{ url_for('logout') }}">Cerrar sesión</a>
            </div>
        </div>
    </div>
</header>
<main>
    <div id="columna-izquierda">
        <div class="menu-item" data-menu="trabajadores">Administrar Trabajadores</div>
        <div class="menu-item" data-menu="clientes">Administrar Clientes</div>
        <div class="menu-item" data-menu="hogares">Administrar Hogares</div>
    </div>
    <div id="columna-secundaria"></div>
    <div id="columna-terciaria">
        <div id="botones-terciarios"></div>
        <div id="formulario-contenedor"></div>
    </div>
</main>
<script>
    const menuItems = document.querySelectorAll('#columna-izquierda .menu-item');
    const columnaSecundaria = document.getElementById('columna-secundaria');
    const columnaTerciaria = document.getElementById('columna-terciaria');
    const botonesTerciarios = document.getElementById('botones-terciarios');
    const contenedorFormulario = document.getElementById('formulario-contenedor');

    function limpiarSecundaria() {
        columnaSecundaria.innerHTML = '';
        columnaSecundaria.style.display = 'none';
        limpiarTerciaria();
    }
    function limpiarTerciaria() {
        botonesTerciarios.innerHTML = '';
        contenedorFormulario.innerHTML = '';
        columnaTerciaria.style.display = 'none';
    }

    function cargarSecundaria(opcion) {
        columnaSecundaria.style.display = 'block';
        columnaTerciaria.style.display = 'none';

        let html = '';
        if (opcion === 'trabajadores') {
            html = `
                <div class="menu-item" data-submenu="gestores">Gestores</div>
                <div class="menu-item" data-submenu="cuidadores">Cuidadores</div>`;
        } else if (opcion === 'clientes') {
            html = `<div class="menu-item" data-submenu="clientes">Clientes</div>`;
        } else if (opcion === 'hogares') {
            html = `<div class="menu-item" data-submenu="hogares">Hogares</div>`;
        }
        columnaSecundaria.innerHTML = html;

        const submenuItems = columnaSecundaria.querySelectorAll('.menu-item');
        submenuItems.forEach(item => {
            item.addEventListener('click', () => {
                submenuItems.forEach(i => i.classList.remove('activo'));
                item.classList.add('activo');
                const submenu = item.getAttribute('data-submenu');
                cargarTerciaria(submenu);
            });
        });
    }

    function cargarTerciaria(submenu) {
        columnaTerciaria.style.display = 'block';
        botonesTerciarios.innerHTML = '';
        contenedorFormulario.innerHTML = '';

        let botones = [];
        if(submenu === 'gestores') {
            botones = ['Añadir Gestor', 'Eliminar Gestor', 'Modificar Gestor'];
        } else if(submenu === 'cuidadores') {
            botones = ['Añadir Cuidador', 'Eliminar Cuidador', 'Modificar Cuidador', 'Horario Cuidador'];
        } else if(submenu === 'clientes') {
            botones = ['Añadir Cliente', 'Eliminar Cliente', 'Modificar Cliente'];
        } else if(submenu === 'hogares') {
            botones = ['Añadir Hogar', 'Eliminar Hogar', 'Modificar Hogar'];
        }

        botones.forEach(botonTexto => {
            const btn = document.createElement('button');
            btn.textContent = botonTexto;
            btn.className = 'boton-accion';
            btn.dataset.accion = botonTexto.toLowerCase().replace(/\s/g, '-');
            btn.addEventListener('click', () => manejarAccion(botonTexto, submenu));
            botonesTerciarios.appendChild(btn);
        });
    }

    function manejarAccion(textoBoton, submenu) {
        contenedorFormulario.innerHTML = '';

        if(textoBoton.startsWith('Añadir')) {
            mostrarFormulario(textoBoton, submenu);
        } else if(textoBoton === 'Horario Cuidador') {
            mostrarFormularioHorario();
        }
    }

    function mostrarFormulario(textoBoton, submenu) {
        let formHTML = '';
        let formClass = '';

        if (submenu === 'gestores') {
            formHTML = `
                <form>
                    <h4>${textoBoton}</h4>
                    <label>Nombre: <input type="text" name="nombre" required></label>
                    <label>Primer Apellido: <input type="text" name="primerApellido" required></label>
                    <label>Segundo Apellido: <input type="text" name="segundoApellido"></label>
                    <label>Usuario: <input type="text" name="usuario" required></label>
                    <label>Contraseña: <input type="password" name="password" required></label>
                    <button type="submit">${textoBoton}</button>
                </form>`;
        } else if (submenu === 'cuidadores') {
            formHTML = `
                <form>
                    <h4>${textoBoton}</h4>
                    <label>Nombre: <input type="text" name="nombre" required></label>
                    <label>Primer Apellido: <input type="text" name="primerApellido" required></label>
                    <label>Segundo Apellido: <input type="text" name="segundoApellido"></label>
                    <label>Usuario: <input type="text" name="usuario" required></label>
                    <label>Contraseña: <input type="password" name="password" required></label>
                    <label>Teléfono: <input type="tel" name="telefono"></label>
                    <button type="submit">${textoBoton}</button>
                </form>`;
        } else if (submenu === 'clientes') {
            formClass = 'form-dos-columnas';
            formHTML = `
                <form class="${formClass}">
                    <h4>${textoBoton}</h4>
                    <label>Gestor:
                        <select name="gestor">
                            <option value="">Seleccione un gestor</option>
                        </select>
                    </label>
                    <label>Nombre: <input type="text" name="nombre" required></label>
                    <label>Primer Apellido: <input type="text" name="primerApellido" required></label>
                    <label>Segundo Apellido: <input type="text" name="segundoApellido"></label>
                    <label>DNI: <input type="text" name="dni" required></label>
                    <label>Sexo: <input type="text" name="sexo"></label>
                    <label>Fecha Nacimiento: <input type="date" name="fechaNacimiento"></label>
                    <label>Teléfono personal: <input type="tel" name="telefonoPersonal"></label>
                    <label>Teléfono familiar: <input type="tel" name="telefonoFamiliar"></label>
                    <label>Hogar: <input type="text" name="hogar"></label>
                    <label>Descripción: <textarea name="descripcion"></textarea></label>
                    <button type="submit">${textoBoton}</button>
                </form>`;
        } else if (submenu === 'hogares') {
            formHTML = `
                <form>
                    <h4>${textoBoton}</h4>
                    <label>Dirección: <input type="text" name="direccion" required></label>
                    <label>Código Postal: <input type="text" name="cp" required></label>
                    <label>Provincia: <input type="text" name="provincia" required></label>
                    <label>URL: <input type="url" name="url"></label>
                    <label>Token: <input type="text" name="token"></label>
                    <button type="submit">${textoBoton}</button>
                </form>`;
        }
        // Bloque para "Modificar" elementos
        if (textoBoton.startsWith('Modificar')) {
            const entidad = submenu;
            const listaEjemplo = [
                { id: 1, nombre: "Juan", apellido1: "Pérez", apellido2: "López", usuario: "juanp", telefono: "600123456", dni: "12345678A", direccion: "Calle Mayor", cp: "34001", provincia: "Palencia" },
                { id: 2, nombre: "Ana", apellido1: "García", apellido2: "Martínez", usuario: "anagm", telefono: "600987654", dni: "87654321B", direccion: "Avenida Libertad", cp: "28001", provincia: "Madrid" }
            ];

            const contenedorBusqueda = document.createElement('div');
            contenedorBusqueda.classList.add('contenedor-busqueda');

            const selectHTML = `
                <label>Seleccionar ${entidad.slice(0, -1)}:
                    <select id="selector-${entidad}">
                        <option value="">Seleccione...</option>
                        ${listaEjemplo.map(item => `<option value="${item.id}">${item.nombre} ${item.apellido1}</option>`).join('')}
                    </select>
                </label>
                <div id="datos-${entidad}" class="datos-modificables"></div>
            `;
            contenedorBusqueda.innerHTML = selectHTML;
            contenedorFormulario.appendChild(contenedorBusqueda);

            const selector = contenedorBusqueda.querySelector(`#selector-${entidad}`);
            const contenedorDatos = contenedorBusqueda.querySelector(`#datos-${entidad}`);

            selector.addEventListener('change', () => {
                contenedorDatos.innerHTML = '';
                const seleccionado = listaEjemplo.find(item => item.id == selector.value);
                if (!seleccionado) return;

                Object.entries(seleccionado).forEach(([clave, valor]) => {
                    if (clave === 'id') return;
                    const campo = document.createElement('div');
                    campo.classList.add('campo-modificable');
                    campo.innerHTML = `
                        <label>${clave.charAt(0).toUpperCase() + clave.slice(1)}:</label>
                        <span class="valor-campo" contenteditable="false">${valor}</span>
                        <button class="editar-campo" title="Editar">&#9998;</button>
                    `;
                    const btnEditar = campo.querySelector('.editar-campo');
                    const spanValor = campo.querySelector('.valor-campo');

                    btnEditar.addEventListener('click', () => {
                        const enEdicion = spanValor.getAttribute('contenteditable') === 'true';
                        if (enEdicion) {
                            spanValor.setAttribute('contenteditable', 'false');
                            btnEditar.innerHTML = '&#9998;';
                            alert(`Nuevo valor de "${clave}": ${spanValor.textContent} (simulado)`); // aquí iría tu llamada a back
                        } else {
                            spanValor.setAttribute('contenteditable', 'true');
                            spanValor.focus();
                            btnEditar.innerHTML = '&#10004;';
                        }
                    });

                    contenedorDatos.appendChild(campo);
                });
            });
        }

        const contenedorForm = document.createElement('div');
        contenedorForm.innerHTML = formHTML;

        const form = contenedorForm.querySelector('form');
        form.addEventListener('submit', e => {
            e.preventDefault();
            alert(`${textoBoton} realizado (simulado)`);
            contenedorFormulario.innerHTML = '';
        });

        contenedorFormulario.appendChild(contenedorForm);
    }

    function mostrarFormularioHorario() {
        const formHTML = `
            <form>
                <h4>Horario Cuidador</h4>
                <label>Día: <input type="text" name="dia" placeholder="Ej: Lunes" required></label>
                <label>Hora inicio: <input type="time" name="horaInicio" required></label>
                <label>Hora fin: <input type="time" name="horaFin" required></label>
                <button type="submit">Guardar Horario</button>
            </form>`;

        const formDiv = document.createElement('div');
        formDiv.innerHTML = formHTML;

        const form = formDiv.querySelector('form');
        form.addEventListener('submit', e => {
            e.preventDefault();
            alert('Horario guardado (simulado)');
            contenedorFormulario.innerHTML = '';
        });

        contenedorFormulario.appendChild(formDiv);
    }

    menuItems.forEach(item => {
        item.addEventListener('click', () => {
            menuItems.forEach(i => i.classList.remove('activo'));
            item.classList.add('activo');
            limpiarSecundaria();
            limpiarTerciaria();
            cargarSecundaria(item.getAttribute('data-menu'));
        });
    });
</script>
</body>
</html>
