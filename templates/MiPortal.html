<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Administrar Sistema</title>
    <link rel="stylesheet" href="../static/css/MiPortal.css" />
</head>
<body>
<header class="main-header" id="movible-header">
    <div class="nav-left">
        <a href="{{ url_for('root') }}">
            <img src="{{ url_for('static', path='img/logo_casa.png') }}" alt="Logo_Casa" class="Logo_Casa" />
        </a>
    </div>

    <div class="nav-center">
        <img src="{{ url_for('static', path='img/img.png') }}" alt="Logo Fundación" class="logo" />
    </div>

    <div class="nav-right">
        <img src="{{ url_for('static', path='img/img_1.png') }}" alt="Foto perfil" />
        <div class="dropdown">
            <span>{{ usuario or "Nombre Usuario" }}</span>
            <div class="dropdown-content">
                <a href="{{ url_for('logout') }}">Cerrar sesión</a>
            </div>
        </div>
    </div>
</header>
<main>
    <!-- Columna izquierda -->
    <div id="columna-izquierda">
        <div class="menu-item" data-menu="trabajadores">Administrar Trabajadores</div>
        <div class="menu-item" data-menu="clientes">Administrar Clientes</div>
        <div class="menu-item" data-menu="hogares">Administrar Hogares</div>
    </div>

    <!-- Columna secundaria -->
    <div id="columna-secundaria"></div>

    <!-- Columna terciaria -->
    <div id="columna-terciaria"></div>
</main>
<script>
    const menuItems = document.querySelectorAll('#columna-izquierda .menu-item');
    const columnaSecundaria = document.getElementById('columna-secundaria');
    const columnaTerciaria = document.getElementById('columna-terciaria');

    let seleccionPrincipal = null;
    let seleccionSecundaria = null;

    // Limpia y oculta columnas
    function limpiarSecundaria() {
        columnaSecundaria.innerHTML = '';
        columnaSecundaria.style.display = 'none';
        limpiarTerciaria();
    }
    function limpiarTerciaria() {
        columnaTerciaria.innerHTML = '';
        columnaTerciaria.style.display = 'none';
        seleccionSecundaria = null;
    }

    // Genera contenido columna secundaria según opción principal
    function cargarSecundaria(opcion) {
        columnaSecundaria.style.display = 'block';
        columnaTerciaria.style.display = 'none';
        columnaTerciaria.innerHTML = '';

        let html = '';
        if (opcion === 'trabajadores') {
            html = `
          <div class="menu-item" data-submenu="gestores">Gestores</div>
          <div class="menu-item" data-submenu="cuidadores">Cuidadores</div>
        `;
        } else if (opcion === 'clientes') {
            html = `<div class="menu-item" data-submenu="clientes">Clientes</div>`;
        } else if (opcion === 'hogares') {
            html = `<div class="menu-item" data-submenu="hogares">Hogares</div>`;
        }
        columnaSecundaria.innerHTML = html;

        // Añadir eventos a submenú
        const submenuItems = columnaSecundaria.querySelectorAll('.menu-item');
        submenuItems.forEach(item => {
            item.addEventListener('click', () => {
                submenuItems.forEach(i => i.classList.remove('activo'));
                item.classList.add('activo');
                seleccionSecundaria = item.getAttribute('data-submenu');
                cargarTerciaria(seleccionSecundaria);
            });
        });
    }

    // Genera contenido columna terciaria según submenú seleccionado
    function cargarTerciaria(submenu) {
        columnaTerciaria.style.display = 'block';
        columnaTerciaria.innerHTML = '';

        let botones = [];
        if(submenu === 'gestores') {
            botones = ['Añadir Gestor', 'Eliminar Gestor', 'Modificar Gestor'];
        } else if(submenu === 'cuidadores') {
            botones = ['Añadir Cuidador', 'Eliminar Cuidador', 'Modificar Cuidador', 'Horario Cuidador'];
        } else if(submenu === 'clientes') {
            botones = ['Añadir Cliente', 'Eliminar Cliente', 'Modificar Cliente'];
        } else if(submenu === 'hogares') {
            botones = ['Añadir Hogar', 'Eliminar Hogar', 'Modificar Hogar'];
        }

        botones.forEach(botonTexto => {
            const btn = document.createElement('button');
            btn.textContent = botonTexto;
            btn.className = 'boton-accion';
            btn.dataset.accion = botonTexto.toLowerCase().replace(/\s/g, '-');
            btn.addEventListener('click', () => manejarAccion(botonTexto, submenu));
            columnaTerciaria.appendChild(btn);
        });
    }

    // Función para mostrar formularios de añadir y modificar (igual que antes) bajo el botón correspondiente
    function manejarAccion(textoBoton, submenu) {
        // Primero quitamos cualquier formulario abierto
        const btns = columnaTerciaria.querySelectorAll('button.boton-accion');
        btns.forEach(b => {
            if(b.nextSibling) {
                b.nextSibling.remove();
            }
        });

        if(textoBoton.startsWith('Añadir')) {
            mostrarFormulario('añadir', submenu);
        } else if(textoBoton.startsWith('Modificar')) {
            mostrarFormulario('modificar', submenu);
        } else if(textoBoton === 'Horario Cuidador') {
            mostrarFormularioHorario();
        } else if(textoBoton.startsWith('Eliminar')) {
            alert(`Función de eliminar para ${submenu} (simulada)`);
        }
    }

    function mostrarFormulario(tipo, submenu) {
        // tipo: 'añadir' o 'modificar'
        // submenu: gestores, cuidadores, clientes, hogares

        let titulo = '';
        if(tipo === 'añadir') titulo = `Añadir ${capitalizar(submenu)}`;
        else if(tipo === 'modificar') titulo = `Modificar ${capitalizar(submenu)}`;

        // Campos comunes
        let formHTML = `
        <form>
          <h4>${titulo}</h4>
          <label>Nombre: <input type="text" name="nombre" required></label>
          <label>Primer Apellido: <input type="text" name="primerApellido" required></label>
          <label>Segundo Apellido: <input type="text" name="segundoApellido"></label>
          <label>Usuario: <input type="text" name="usuario" required></label>
          <label>Teléfono: <input type="tel" name="telefono"></label>
          <button type="submit">${tipo === 'añadir' ? 'Añadir' : 'Modificar'}</button>
        </form>
      `;

        // En clientes y hogares puede ser diferente, pero dejamos igual para simplicidad
        // En cuidadores, para añadir o modificar es igual que gestores

        // Añadimos formulario justo debajo del botón clicado
        // Para eso necesitamos el botón clicado, lo pasamos con closure o buscamos el último botón activo.

        // Vamos a insertar el formulario debajo del botón clicado:
        // Buscamos el botón que tiene el foco
        const btns = columnaTerciaria.querySelectorAll('button.boton-accion');
        let btnActivo = null;
        btns.forEach(b => {
            if(document.activeElement === b) {
                btnActivo = b;
            }
        });

        // Si no detectamos focus, insertamos al final (fallback)
        if(!btnActivo) btnActivo = btns[0];

        // Crear contenedor div para el formulario
        const contenedorForm = document.createElement('div');
        contenedorForm.innerHTML = formHTML;

        // Añadimos listener submit para simular acción
        const form = contenedorForm.querySelector('form');
        form.addEventListener('submit', e => {
            e.preventDefault();
            alert(`${titulo} realizado (simulado)`);
            contenedorForm.remove();
        });

        btnActivo.insertAdjacentElement('afterend', contenedorForm);
    }

    function mostrarFormularioHorario() {
        // Similar a otros, pero con campos de horario
        // Insertamos debajo del botón "Horario Cuidador"
        const btns = columnaTerciaria.querySelectorAll('button.boton-accion');
        let btnHorario = null;
        btns.forEach(b => {
            if(b.textContent === 'Horario Cuidador') btnHorario = b;
        });
        if(!btnHorario) return;

        // Quitar formularios abiertos
        btns.forEach(b => { if(b.nextSibling) b.nextSibling.remove(); });

        const formHTML = `
        <form>
          <h4>Horario Cuidador</h4>
          <label>Día: <input type="text" name="dia" placeholder="Ej: Lunes" required></label>
          <label>Hora inicio: <input type="time" name="horaInicio" required></label>
          <label>Hora fin: <input type="time" name="horaFin" required></label>
          <button type="submit">Guardar Horario</button>
        </form>
      `;

        const contenedorForm = document.createElement('div');
        contenedorForm.innerHTML = formHTML;

        const form = contenedorForm.querySelector('form');
        form.addEventListener('submit', e => {
            e.preventDefault();
            alert('Horario guardado (simulado)');
            contenedorForm.remove();
        });

        btnHorario.insertAdjacentElement('afterend', contenedorForm);
    }

    // Capitaliza primera letra
    function capitalizar(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Eventos principal menú
    menuItems.forEach(item => {
        item.addEventListener('click', () => {
            // Marcar activo
            menuItems.forEach(i => i.classList.remove('activo'));
            item.classList.add('activo');

            seleccionPrincipal = item.getAttribute('data-menu');
            limpiarSecundaria();
            limpiarTerciaria();

            cargarSecundaria(seleccionPrincipal);
        });
    });
</script>
</body>
</html>